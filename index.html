<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>Maritime Explorer: Nature & Wildlife Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .tab-active { border-bottom: 3px solid #db2777; color: #be185d; font-weight: 700; background-color: rgba(219, 39, 119, 0.05); }
        .tab-inactive { color: #64748b; font-weight: 500; }
        .tab-inactive:hover { color: #334155; background-color: #f1f5f9; }
        #map { width: 100%; height: 500px; border-radius: 0.75rem; z-index: 1; }
        .timeline-line { position: absolute; left: 50%; transform: translateX(-50%); width: 4px; height: 100%; background-color: #e2e8f0; z-index: 0; }
        /* Hero Image: Beluga Whale */
        .hero-bg { background-image: linear-gradient(rgba(190, 24, 93, 0.85), rgba(88, 28, 135, 0.8)), url('https://images.unsplash.com/photo-1576169904975-d22792888941?q=80&w=1920&auto=format&fit=crop'); background-size: cover; background-position: center 40%; }
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.98); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); } }
        .animate-pulse-red { animation: pulse-red 2s infinite; }
        .img-fallback { background-color: #fce7f3; background-image: radial-gradient(#db2777 0.5px, #fce7f3 0.5px); background-size: 10px 10px; display: flex; align-items: center; justify-content: center; color: #be185d; font-weight: bold; text-transform: uppercase; font-size: 0.75rem; }
    </style>
</head>
<body class="text-slate-800">

    <!-- PASSWORD OVERLAY -->
    <div id="login-overlay">
        <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center border-4 border-pink-500/20">
            <div class="text-5xl mb-6">üîí</div>
            <h2 class="text-2xl font-bold text-slate-800 mb-2">Maritime Planner</h2>
            <p class="text-sm text-slate-500 mb-6">Enter password to view itinerary.</p>
            <input type="password" id="password-input" placeholder="Enter password" class="w-full p-3 border border-slate-300 rounded-lg mb-4 focus:ring-2 focus:ring-pink-500 outline-none transition text-center text-lg">
            <button onclick="checkPassword()" class="w-full bg-pink-700 text-white font-bold py-3 rounded-lg hover:bg-pink-800 transition shadow-lg transform active:scale-95">Unlock Plan</button>
            <p id="error-msg" class="text-red-500 text-xs mt-3 hidden font-bold">Incorrect password.</p>
        </div>
    </div>

    <!-- MAIN APP CONTAINER -->
    <div id="app-container" class="hidden max-w-7xl mx-auto min-h-screen flex flex-col bg-slate-50 shadow-2xl my-0 md:my-8 rounded-2xl overflow-hidden">
        
        <!-- Hero Header -->
        <header class="hero-bg text-white p-8 md:p-12 shadow-lg">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-2">The Nature Loop</h1>
                    <p class="text-pink-100 text-xl font-light">Ottawa &#8594; PEI &#8594; Whales (QC) &#8594; Ottawa</p>
                </div>
                <div class="mt-6 md:mt-0 bg-white/10 backdrop-blur-md px-6 py-3 rounded-xl border border-white/20">
                    <span class="block text-xs text-pink-200 uppercase tracking-widest font-bold mb-1">Trip Profile</span>
                    <div class="flex items-center space-x-6">
                        <div class="flex items-center">
                            <span class="text-2xl mr-2">üê∂</span>
                            <span class="font-bold">With Finn</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-2xl mr-2">üêã</span>
                            <span class="font-bold">Whales Added</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
            <div class="flex overflow-x-auto px-4 md:px-8">
                <button onclick="switchTab('route')" id="tab-route" class="tab-active py-5 px-6 whitespace-nowrap transition-all flex items-center"><span class="mr-2">üó∫Ô∏è</span> Itinerary</button>
                <button onclick="switchTab('budget')" id="tab-budget" class="tab-inactive py-5 px-6 whitespace-nowrap transition-all flex items-center"><span class="mr-2">üí∞</span> Budget</button>
                <button onclick="switchTab('attractions')" id="tab-attractions" class="tab-inactive py-5 px-6 whitespace-nowrap transition-all flex items-center"><span class="mr-2">ü¶Ö</span> Wildlife & Nature</button>
                <button onclick="switchTab('logistics')" id="tab-logistics" class="tab-inactive py-5 px-6 whitespace-nowrap transition-all flex items-center"><span class="mr-2">üìã</span> Logistics <span class="ml-2 bg-red-500 text-white text-[10px] px-1 rounded animate-pulse">!</span></button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-grow p-4 md:p-8">

            <!-- TAB: ROUTE -->
            <section id="content-route" class="space-y-8 animate-fade-in">
                
                <!-- Dynamic Stats Summary -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-slate-800 text-white p-4 rounded-xl shadow-md">
                        <div class="text-xs text-slate-400 uppercase font-bold tracking-wider">Total Distance</div>
                        <div class="text-2xl font-bold">~2,850 km</div>
                    </div>
                    <div class="bg-slate-800 text-white p-4 rounded-xl shadow-md">
                        <div class="text-xs text-slate-400 uppercase font-bold tracking-wider">Whale Watch</div>
                        <div class="text-2xl font-bold">Sat AM</div>
                    </div>
                    <div class="bg-white border border-slate-200 p-4 rounded-xl shadow-sm">
                        <div class="text-xs text-slate-500 uppercase font-bold tracking-wider">Return Pacing</div>
                        <div class="text-2xl font-bold text-green-600">Relaxed</div>
                    </div>
                    <div class="bg-white border border-slate-200 p-4 rounded-xl shadow-sm">
                        <div class="text-xs text-slate-500 uppercase font-bold tracking-wider">Finn's Comfort</div>
                        <div class="text-2xl font-bold text-slate-800">High</div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-8">
                    <div id="map"></div>
                </div>
                
                <!-- Timeline -->
                <div class="relative" id="timeline-container">
                    <div class="hidden md:block timeline-line"></div>
                    
                    <!-- STOP 1 -->
                    <div class="flex flex-col md:flex-row items-center mb-12 relative z-10">
                        <div class="w-full md:w-1/2 md:pr-12 text-center md:text-right mb-4 md:mb-0">
                            <h3 class="text-xl font-bold text-pink-900">Sat, Aug 15: Trapper's Cabin</h3>
                            <p class="text-sm text-slate-600">Ottawa &#8594; Upper Kintore, NB. The adventure begins.</p>
                            <span class="inline-block bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded mt-1">‚úÖ Booked ($116)</span>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-pink-600 border-4 border-white shadow-lg flex items-center justify-center text-white font-bold">1</div>
                        <div class="w-full md:w-1/2 md:pl-12 hidden md:block"></div>
                    </div>

                    <!-- STOP 2 -->
                    <div class="flex flex-col md:flex-row items-center mb-12 relative z-10">
                        <div class="w-full md:w-1/2 md:pr-12 hidden md:block"></div>
                        <div class="w-10 h-10 rounded-full bg-amber-500 border-4 border-white shadow-lg flex items-center justify-center text-white font-bold">2</div>
                        <div class="w-full md:w-1/2 md:pl-12 text-center md:text-left mb-4 md:mb-0">
                            <h3 class="text-xl font-bold text-slate-800">Aug 16-18: Stanhope Camping</h3>
                            <p class="text-sm text-slate-600">Cross Bridge. Family visit. Beach camping.</p>
                            <span class="inline-block bg-red-100 text-red-800 text-xs font-bold px-2 py-1 rounded mt-1">‚è∞ Book Feb 9th (7am)</span>
                        </div>
                    </div>

                    <!-- STOP 3 -->
                    <div class="flex flex-col md:flex-row items-center mb-12 relative z-10">
                        <div class="w-full md:w-1/2 md:pr-12 text-center md:text-right mb-4 md:mb-0">
                            <h3 class="text-xl font-bold text-slate-800">Aug 18-20: Charlottetown</h3>
                            <p class="text-sm text-slate-600">Post-camping luxury. B&B stay. Explore East/West tips.</p>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-green-600 border-4 border-white shadow-lg flex items-center justify-center text-white font-bold">3</div>
                        <div class="w-full md:w-1/2 md:pl-12 hidden md:block"></div>
                    </div>

                    <!-- STOP 4 (FUNDY) -->
                    <div class="flex flex-col md:flex-row items-center mb-12 relative z-10">
                        <div class="w-full md:w-1/2 md:pr-12 hidden md:block"></div>
                        <div class="w-10 h-10 rounded-full bg-teal-600 border-4 border-white shadow-lg flex items-center justify-center text-white font-bold">4</div>
                        <div class="w-full md:w-1/2 md:pl-12 text-center md:text-left mb-4 md:mb-0">
                            <span class="inline-block bg-teal-100 text-teal-800 text-xs font-bold px-2 py-1 rounded border border-teal-200 mb-2">
                                BAY OF FUNDY
                            </span>
                            <h3 class="text-xl font-bold text-teal-900">Thu, Aug 20: The Tides</h3>
                            <p class="text-sm text-slate-600">Depart PEI. Visit Hopewell Rocks. Stay in <strong>Alma</strong>.</p>
                        </div>
                    </div>

                    <!-- STOP 5 (RIVIERE DU LOUP - OVERNIGHT) -->
                    <div class="flex flex-col md:flex-row items-center mb-12 relative z-10">
                        <div class="w-full md:w-1/2 md:pr-12 text-center md:text-right mb-4 md:mb-0">
                            <span class="inline-block bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded border border-blue-200 mb-2">
                                OVERNIGHT FOR WHALES
                            </span>
                            <h3 class="text-xl font-bold text-slate-800">Fri, Aug 21: Arrive Rivi√®re-du-Loup</h3>
                            <p class="text-sm text-slate-600">Drive 4.5h from Fundy. Check into Pet-Friendly Hotel. Walk Finn at park.</p>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-blue-600 border-4 border-white shadow-lg flex items-center justify-center text-white font-bold">5</div>
                        <div class="w-full md:w-1/2 md:pl-12 hidden md:block"></div>
                    </div>

                    <!-- STOP 6 (WHALES & HOME) -->
                    <div class="flex flex-col md:flex-row items-center relative z-10">
                        <div class="w-full md:w-1/2 md:pr-12 hidden md:block"></div>
                        <div class="w-10 h-10 rounded-full bg-slate-700 border-4 border-white shadow-lg flex items-center justify-center text-white font-bold">6</div>
                        <div class="w-full md:w-1/2 md:pl-12 text-center md:text-left mb-4 md:mb-0">
                            <h3 class="text-xl font-bold text-slate-800">Sat, Aug 22: Whales then Home</h3>
                            <ul class="text-sm text-slate-600 list-disc pl-4 mt-2">
                                <li><strong>09:30 AM:</strong> AML Whale Cruise (Finn naps in hotel).</li>
                                <li><strong>13:00 PM:</strong> Lunch & Walk Finn.</li>
                                <li><strong>14:00 PM:</strong> Easy 6h Drive to Ottawa.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB: BUDGET -->
            <section id="content-budget" class="hidden space-y-8 animate-fade-in">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Controls -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                        <h2 class="text-xl font-bold text-slate-800 mb-4">Cost Estimator</h2>
                        <div class="space-y-6">
                            <!-- ACCOMMODATION FIXED COST ALERT -->
                            <div class="space-y-2">
                                <div class="bg-green-50 border border-green-200 rounded-lg p-3 flex justify-between items-center">
                                    <span class="text-xs font-bold text-green-800 uppercase">Booked: Night 1 (Cabin)</span>
                                    <span class="text-sm font-bold text-green-700">$116</span>
                                </div>
                                <div class="bg-green-50 border border-green-200 rounded-lg p-3 flex justify-between items-center">
                                    <span class="text-xs font-bold text-green-800 uppercase">Camping (2 Nts)</span>
                                    <span class="text-sm font-bold text-green-700">~$100</span>
                                </div>
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 flex justify-between items-center">
                                    <span class="text-xs font-bold text-blue-800 uppercase">Whale Cruise (2 Tix)</span>
                                    <span class="text-sm font-bold text-blue-700">~$200</span>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2 flex justify-between">
                                    <span>Total Trip Duration (Days)</span>
                                    <span id="val-days" class="text-pink-600 font-bold">8</span>
                                </label>
                                <input type="range" id="input-days" min="5" max="14" value="8" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-pink-600">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2 flex justify-between">
                                    <span>Remaining 4 Nights (B&Bs)</span>
                                    <span class="text-pink-600 font-bold">$<span id="val-accom">180</span></span>
                                </label>
                                <input type="range" id="input-accom" min="120" max="400" step="10" value="180" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-pink-600">
                                <p class="text-xs text-slate-400 mt-1">Charlottetown, Alma, Riv-du-Loup</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2 flex justify-between">
                                    <span>Food / Person / Day</span>
                                    <span class="text-pink-600 font-bold">$<span id="val-food">75</span></span>
                                </label>
                                <input type="range" id="input-food" min="40" max="200" step="5" value="75" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-pink-600">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-slate-700 mb-2 flex justify-between">
                                    <span>Gas Price</span>
                                    <span class="text-pink-600 font-bold">$<span id="val-gas">1.65</span></span>
                                </label>
                                <input type="range" id="input-gas" min="1.30" max="2.20" step="0.05" value="1.65" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-pink-600">
                            </div>
                        </div>

                        <div class="mt-8 pt-6 border-t border-slate-100">
                            <div class="flex justify-between items-end mb-2">
                                <span class="text-slate-600 font-medium">Total Cost</span>
                                <span id="total-cost" class="text-3xl font-bold text-slate-800">$0</span>
                            </div>
                            <div class="flex justify-between items-end bg-pink-50 p-3 rounded-lg">
                                <span class="text-pink-800 text-sm font-medium">Per Person</span>
                                <span id="per-person-cost" class="text-xl font-bold text-pink-700">$0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Visualization -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col justify-center">
                        <div class="relative w-full max-w-[500px] mx-auto h-[350px]">
                            <canvas id="budgetChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TAB: ATTRACTIONS (Restored & Enhanced) -->
            <section id="content-attractions" class="hidden space-y-8 animate-fade-in">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Wildlife & Nature Targets</h2>
                        <p class="text-slate-600" id="attraction-subtitle">Your target species for this trip.</p>
                    </div>
                    <div class="flex space-x-2 mt-4 md:mt-0 flex-wrap gap-2">
                        <button onclick="renderAttractions('all')" class="px-4 py-2 text-sm bg-slate-800 text-white rounded-full">All</button>
                        <button onclick="renderAttractions('mammals')" class="px-4 py-2 text-sm bg-white border border-blue-200 text-blue-700 rounded-full font-bold">Whales & Foxes</button>
                        <button onclick="renderAttractions('birds')" class="px-4 py-2 text-sm bg-white border border-amber-200 text-amber-700 rounded-full font-bold">Birding</button>
                        <button onclick="renderAttractions('scenic')" class="px-4 py-2 text-sm bg-white border border-green-200 text-green-700 rounded-full font-bold">Landscapes</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="attraction-grid"></div>
            </section>

            <!-- TAB: LOGISTICS -->
            <section id="content-logistics" class="hidden space-y-8 animate-fade-in">
                <!-- CRITICAL BOOKING ALERT -->
                <div class="bg-red-50 border-l-4 border-red-500 p-6 rounded-r-xl shadow-sm mb-8 animate-pulse-red">
                    <div class="flex items-start">
                        <div class="text-3xl mr-4">‚è∞</div>
                        <div>
                            <h3 class="text-xl font-bold text-red-700">CRITICAL: Stanhope Booking</h3>
                            <p class="text-sm text-red-900 mt-1 font-semibold">Parks Canada Reservations Open: <span class="underline">Feb 9th @ 7:00 AM ET</span>.</p>
                            <p class="text-xs text-red-800 mt-2">Log in at 6:45 AM. Target: <strong>Stanhope Campground</strong> (North Shore).</p>
                        </div>
                    </div>
                </div>

                <!-- PET LOGISTICS (NEW) -->
                <div class="bg-blue-50 border border-blue-200 rounded-2xl shadow-sm mb-8 overflow-hidden">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <span class="text-3xl mr-3">üê∂</span>
                            <h3 class="text-xl font-bold text-blue-900">Finn's Logistics (Riviere-du-Loup)</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-2">Friday Evening (Aug 21)</h4>
                                <ul class="text-sm text-slate-600 space-y-1 list-disc pl-4">
                                    <li><strong>Walk:</strong> <span class="text-blue-600 underline">Parc de la Pointe</span> is perfect for sunset dog walking.</li>
                                    <li><strong>Stay:</strong> Ensure hotel allows dogs to be left alone (crate usually required) for Sat AM.</li>
                                </ul>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <h4 class="font-bold text-slate-800 mb-2">Saturday Morning (Whales)</h4>
                                <ul class="text-sm text-slate-600 space-y-1 list-disc pl-4">
                                    <li><strong>Timing:</strong> 9:30 AM - 1:00 PM.</li>
                                    <li><strong>Action:</strong> Walk Finn aggressively before 9am. Leave him settled in crate in hotel room.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Night 1 Confirmed -->
                <div class="bg-white rounded-2xl shadow-lg border border-green-100 mb-8 overflow-hidden">
                    <div class="bg-green-700 p-4 text-white flex justify-between items-center">
                        <h3 class="text-lg font-bold flex items-center"><span class="text-2xl mr-2">‚úÖ</span> Night 1: Trapper's Cabin</h3>
                        <span class="bg-white/20 text-xs px-2 py-1 rounded uppercase font-bold">Booked</span>
                    </div>
                    <div class="p-6">
                        <div class="flex items-center text-sm text-slate-700 mb-2">
                            <span class="font-bold mr-2">Vehicle:</span> Kia Sportage (High clearance for access).
                        </div>
                        <div class="flex items-center text-sm text-slate-700">
                            <span class="font-bold mr-2">Prep:</span> Buy groceries in Grand Falls. No stores near cabin.
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="bg-slate-800 text-slate-400 p-8 text-center text-sm">
            <p>&copy; 2026 Maritime Trip Planner.</p>
        </footer>
    </div>

    <script>
        // --- ASSETS ---
        // Using Unsplash Direct Links for high reliability
        const assets = {
            aunt: 'https://images.unsplash.com/photo-1542318859-99c08d984143?q=80&w=800&auto=format&fit=crop',
            anne: 'https://images.unsplash.com/photo-1599946347371-68eb71b16afc?q=80&w=800&auto=format&fit=crop', 
            brackley: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=800&auto=format&fit=crop', 
            basin: 'https://images.unsplash.com/photo-1476673160081-cf060971a4ae?q=80&w=800&auto=format&fit=crop', 
            hopewell: 'https://images.unsplash.com/photo-1483729558449-99ef09a8c325?q=80&w=800&auto=format&fit=crop', 
            fundy: 'https://images.unsplash.com/photo-1443632864897-14973fa006cf?q=80&w=800&auto=format&fit=crop',
            charlottetown: 'https://images.unsplash.com/photo-1555685812-4b943f3e99a0?q=80&w=800&auto=format&fit=crop',
            beluga: 'https://images.unsplash.com/photo-1568430462989-44163eb1752f?q=80&w=800&auto=format&fit=crop',
            fox: 'https://images.unsplash.com/photo-1474511320723-9a56873867b5?q=80&w=800&auto=format&fit=crop',
            plover: 'https://images.unsplash.com/photo-1552353617-3913788a1834?q=80&w=800&auto=format&fit=crop',
            seal: 'https://images.unsplash.com/photo-1563200767-17b070921869?q=80&w=800&auto=format&fit=crop',
            falcon: 'https://images.unsplash.com/photo-1619623696803-b097b667232c?q=80&w=800&auto=format&fit=crop'
        };

        const attractions = [
            { title: "Beluga Whales", cat: "mammals", loc: "Rivi√®re-du-Loup (QC)", img: assets.beluga, desc: "Saturday AM Boat Tour. White whales in the St. Lawrence!" },
            { title: "Red Foxes", cat: "mammals", loc: "Stanhope (PEI)", img: assets.fox, desc: "PEI's famous red foxes roam the campground dunes." },
            { title: "Grey Seals", cat: "mammals", loc: "Point Prim (PEI)", img: assets.seal, desc: "Hauled out on the rocks at low tide near the lighthouse." },
            { title: "Piping Plovers", cat: "birds", loc: "Greenwich Dunes (PEI)", img: assets.plover, desc: "Endangered shorebirds nesting on the beaches." },
            { title: "Peregrine Falcons", cat: "birds", loc: "Hopewell Rocks (NB)", img: assets.falcon, desc: "They nest on the flowerpot rocks. Watch them dive!" },
            { title: "Basin Head", cat: "scenic", loc: "Eastern PEI", img: assets.basin, desc: "Singing Sands and the famous bridge jump." },
            { title: "Hopewell Rocks", cat: "scenic", loc: "Bay of Fundy", img: assets.hopewell, desc: "Walk on the ocean floor at low tide." },
            { title: "Brackley Beach", cat: "scenic", loc: "PEI National Park", img: assets.brackley, desc: "Massive dunes and warm water for swimming." }
        ];

        // --- MAP LOGIC ---
        let mapInstance = null;
        function initLeafletMap() {
            if (mapInstance) return;
            mapInstance = L.map('map', { scrollWheelZoom: false }).setView([46.8, -66], 6);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap', subdomains: 'abcd', maxZoom: 19 }).addTo(mapInstance);

            const locs = {
                ottawa: [45.4215, -75.6972],
                trapper: [46.7, -67.6],
                stanhope: [46.4, -63.1],
                charlottetown: [46.2, -63.1],
                alma: [45.6, -64.9], 
                rdl: [47.8, -69.5], 
                bridge: [46.2, -63.7]
            };

            // Leg 1: Ottawa -> Trapper
            L.polyline([locs.ottawa, [46.8, -71.2], locs.trapper], {color: '#db2777', weight: 5}).addTo(mapInstance);
            
            // Leg 2: Trapper -> Stanhope (Into PEI)
            L.polyline([locs.trapper, locs.bridge, locs.stanhope], {color: '#db2777', weight: 5}).addTo(mapInstance);

            // Leg 3: Return via Fundy (Alma) -> RDL -> Home
            L.polyline([locs.charlottetown, locs.bridge, locs.alma], {color: '#059669', weight: 5}).addTo(mapInstance);
            L.polyline([locs.alma, locs.rdl], {color: '#059669', weight: 5}).addTo(mapInstance);
            L.polyline([locs.rdl, locs.ottawa], {color: '#64748b', weight: 3, dashArray: '5, 10'}).addTo(mapInstance);

            L.marker(locs.ottawa).addTo(mapInstance).bindPopup("Ottawa");
            L.marker(locs.trapper).addTo(mapInstance).bindPopup("Trapper's Cabin (Night 1)");
            L.marker(locs.stanhope).addTo(mapInstance).bindPopup("Stanhope Camp (Nights 2-3)");
            L.marker(locs.alma).addTo(mapInstance).bindPopup("Fundy/Alma (Night 6)");
            L.marker(locs.rdl).addTo(mapInstance).bindPopup("Rivi√®re-du-Loup (Night 7: Whales)");
        }

        // --- BUDGET ---
        let budgetChartInstance = null;
        function updateBudget() {
            const inputs = ['accom', 'food', 'gas'];
            const vals = {};
            inputs.forEach(id => vals[id] = parseFloat(document.getElementById(`input-${id}`)?.value || 0));
            
            // Fixed Costs
            const trapper = 116;
            const camping = 100; 
            const whales = 200; 
            const fixedAccom = trapper + camping;
            
            // Variable Costs
            let km = 2850; 
            let fuel = 9.5; 
            let gas = Math.round((km/100) * fuel * vals.gas);
            let bridge = 50.25; 
            
            // Accom Remainder
            let remDays = 4;
            let varAccom = remDays * vals.accom;
            
            // 8 Days Total (Food/Gas)
            let totalDays = 8;
            let total = gas + bridge + fixedAccom + varAccom + whales + (vals.food * 2 * totalDays);
            
            document.getElementById('total-cost').innerText = '$' + total.toLocaleString();
            document.getElementById('per-person-cost').innerText = '$' + Math.round(total/2).toLocaleString();
            
            if(budgetChartInstance) {
                budgetChartInstance.data.datasets[0].data = [gas, fixedAccom + varAccom, vals.food*2*totalDays, bridge + whales + 150];
                budgetChartInstance.update();
            }
        }

        function initBudgetCalc() {
            const ctx = document.getElementById('budgetChart').getContext('2d');
            budgetChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: ['Transport', 'Stay', 'Food', 'Fun'], datasets: [{ data: [1,1,1,1], backgroundColor: ['#0891b2', '#f59e0b', '#10b981', '#6366f1'] }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%' }
            });
            ['accom', 'food', 'gas'].forEach(id => document.getElementById(`input-${id}`).addEventListener('input', updateBudget));
            updateBudget();
        }

        // --- ATTRACTIONS ---
        function renderAttractions(filter) {
            const grid = document.getElementById('attraction-grid');
            grid.innerHTML = '';
            attractions.forEach(item => {
                if(filter !== 'all' && item.cat !== filter) return;
                const card = document.createElement('div');
                card.className = "bg-white rounded-xl shadow-lg border border-slate-100 overflow-hidden";
                
                // Fallback Logic
                let fallback = 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=800&auto=format&fit=crop';
                if(item.cat === 'mammals') fallback = 'https://images.unsplash.com/photo-1474511320723-9a56873867b5?q=80&w=800&auto=format&fit=crop';
                
                card.innerHTML = `
                    <div class="h-48 overflow-hidden relative">
                        <img src="${item.img}" 
                             class="w-full h-full object-cover" 
                             onerror="this.src='${fallback}'">
                        <div class="absolute top-2 right-2 bg-white/90 text-xs font-bold px-2 py-1 rounded shadow uppercase">${item.cat}</div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-lg font-bold text-slate-800">${item.title}</h3>
                        <p class="text-xs font-bold text-slate-400 uppercase mb-2">üìç ${item.loc}</p>
                        <p class="text-sm text-slate-600">${item.desc}</p>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- PASSWORD ---
        function checkPassword() {
            if (document.getElementById('password-input').value.toLowerCase() === 'maritime') {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('app-container').classList.remove('hidden');
                setTimeout(() => { initLeafletMap(); initBudgetCalc(); }, 100);
            } else {
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }
        document.getElementById('password-input').addEventListener('keypress', (e) => { if(e.key==='Enter') checkPassword(); });

        function switchTab(id) {
            ['route','budget','attractions','logistics'].forEach(t => {
                document.getElementById(`content-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('tab-inactive');
            });
            document.getElementById(`content-${id}`).classList.remove('hidden');
            document.getElementById(`tab-${id}`).classList.add('tab-active');
            if (id === 'route' && mapInstance) setTimeout(() => mapInstance.invalidateSize(), 100);
        }

        document.addEventListener('DOMContentLoaded', () => { renderAttractions('all'); });
    </script>
</body>
</html>
